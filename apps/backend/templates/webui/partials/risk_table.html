{% load i18n %}
<p class="muted">
  <span class="badge">{{ risks|length }}</span> {% trans "risks listed" %}
  {% if is_paginated %}
    <span class="muted">({% trans "Page" %} {{ page_obj.number }} / {{ page_obj.paginator.num_pages }})</span>
  {% endif %}
</p>
<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th><input type="checkbox" id="risk-select-all" form="bulk-update-form" /></th>
      <th>{% trans "ID" %}</th>
      <th>{% trans "Title" %}</th>
      <th>{% trans "Status" %}</th>
      <th>{% trans "Primary Asset" %}</th>
      <th>{% trans "Business Unit" %}</th>
      <th>{% trans "Cost Center" %}</th>
      <th>{% trans "Section" %}</th>
      <th>{% trans "Asset Type" %}</th>
      <th>{% trans "Scoring Method" %}</th>
      <th>{% trans "Scores" %}</th>
      <th>{% trans "Treatments" %}</th>
      <th>{% trans "Latest Review" %}</th>
      <th>{% trans "Actions" %}</th>
    </tr>
  </thead>
  <tbody>
    {% for risk in risks %}
    <tr>
      <td><input type="checkbox" name="risk_ids" value="{{ risk.id }}" class="risk-select" form="bulk-update-form" /></td>
      <td>{{ risk.id }}</td>
      <td><a href="{% url 'webui:risk-detail' risk.id %}">{{ risk.title }}</a></td>
      <td id="risk-status-{{ risk.id }}">{% include "webui/partials/risk_status_cell.html" with risk=risk risk_status_choices=risk_status_choices can_manage_risks=can_manage_risks origin="list" %}</td>
      <td>{{ risk.primary_asset.asset_code }}</td>
      <td>{% if risk.business_unit %}{{ risk.business_unit.code }}{% endif %}</td>
      <td>{% if risk.cost_center %}{{ risk.cost_center.code }}{% endif %}</td>
      <td>{% if risk.section %}{{ risk.section.code }}{% endif %}</td>
      <td>{% if risk.asset_type %}{{ risk.asset_type.code }}{% endif %}</td>
      <td>{% if risk.scoring_method %}{{ risk.scoring_method.code }}{% endif %}</td>
      <td>{{ risk.inherent_score }} / {{ risk.residual_score }}</td>
      <td>{{ risk.treatments.count }}</td>
      <td>
        {% with review=risk.reviews.first %}
          {% if review %}
            {{ review.decision }} by {{ review.reviewer.username }}
          {% endif %}
        {% endwith %}
      </td>
      <td>
        <a href="{% url 'webui:risk-detail' risk.id %}" class="btn btn-outline-secondary btn-sm">{% trans "Edit" %}</a>
      </td>
    </tr>
    {% empty %}
    <tr><td colspan="14">{% trans "No risks found." %}</td></tr>
    {% endfor %}
  </tbody>
</table>
{% if is_paginated %}
  <div class="actions" style="justify-content: flex-end;">
    {% if page_obj.has_previous %}
      <a class="btn btn-outline-secondary btn-sm"
         hx-get="?page={{ page_obj.previous_page_number }}&q={{ query }}&status={{ selected_status }}&business_unit_code={{ selected_business_unit_code }}"
         hx-target="#risk-table-container"
         hx-push-url="true">{% trans "Previous" %}</a>
    {% endif %}
    <span class="muted">{% trans "Page" %} {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
      <a class="btn btn-outline-secondary btn-sm"
         hx-get="?page={{ page_obj.next_page_number }}&q={{ query }}&status={{ selected_status }}&business_unit_code={{ selected_business_unit_code }}"
         hx-target="#risk-table-container"
         hx-push-url="true">{% trans "Next" %}</a>
    {% endif %}
  </div>
{% endif %}
